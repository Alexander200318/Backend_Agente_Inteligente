<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; max-height: 400px; overflow-y: auto; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    
    <div>
        <label>Host: <input type="text" id="host" value="api.engine-tecai.me" style="width: 300px;"></label>
        <label>Session ID: <input type="text" id="sessionId" value="test-web-session-12345" style="width: 300px;"></label>
        <button onclick="testWebSocket()">Connect</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="log" id="log"></div>
    
    <script>
        let ws = null;
        
        function log(message, isError = false) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function testWebSocket() {
            const host = document.getElementById('host').value;
            const sessionId = document.getElementById('sessionId').value;
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${host}/ws/chat/${sessionId}`;
            
            log(`Attempting to connect to: ${wsUrl}`);
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    log(`‚úÖ Connected successfully!`);
                    ws.send(JSON.stringify({ type: 'test', message: 'Hello' }));
                };
                
                ws.onmessage = function(event) {
                    log(`üì® Message: ${event.data}`);
                };
                
                ws.onerror = function(error) {
                    log(`‚ùå WebSocket Error: ${error.message}`, true);
                    if (ws) {
                        log(`ReadyState: ${ws.readyState}`, true);
                    }
                };
                
                ws.onclose = function() {
                    log(`üîå Connection closed`);
                };
                
            } catch(e) {
                log(`‚ùå Error: ${e.message}`, true);
            }
        }
        
        // Auto-test on load
        window.onload = function() {
            log('Page loaded. Ready to test.');
        };
    </script>
</body>
</html>
